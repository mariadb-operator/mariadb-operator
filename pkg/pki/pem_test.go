package pki

import (
	"testing"

	"github.com/go-logr/logr"
	"github.com/google/go-cmp/cmp"
)

func TestBundleCertificatePEMs(t *testing.T) {
	logger := logr.Logger{}
	tests := []struct {
		name      string
		pems      [][]byte
		wantBytes []byte
		wantErr   bool
	}{
		{
			name:      "nil",
			pems:      nil,
			wantBytes: nil,
			wantErr:   true,
		},
		{
			name: "empty",
			pems: [][]byte{
				[]byte(""),
				[]byte(""),
			},
			wantBytes: nil,
			wantErr:   true,
		},
		{
			name: "invalid PEM",
			pems: [][]byte{
				[]byte("test"),
			},
			wantBytes: nil,
			wantErr:   true,
		},
		{
			name: "invalid cert",
			pems: [][]byte{
				[]byte(`-----BEGIN CERTIFICATE-----
FOO
-----END CERTIFICATE-----
`),
			},
			wantBytes: nil,
			wantErr:   true,
		},
		{
			name: "mixed valid and invalid PEMs",
			pems: [][]byte{
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				[]byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
				[]byte("invalid data"),
			},
			// Subject: CN=mariadb-client-ca
			// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
			wantBytes: []byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
			wantErr: false,
		},
		{
			name: "single PEM with single block",
			pems: [][]byte{
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				[]byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
			},
			// Subject: CN=mariadb-client-ca
			// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
			wantBytes: []byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
			wantErr: false,
		},
		{
			name: "multiple PEMs with single block",
			pems: [][]byte{
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				[]byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
				// Subject: CN=mariadb-server-ca
				// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
				[]byte(`-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
`),
			},
			// Subject: CN=mariadb-client-ca
			// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
			// Subject: CN=mariadb-server-ca
			// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
			wantBytes: []byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
`),
			wantErr: false,
		},
		{
			name: "multiple PEMs with multiple blocks",
			pems: [][]byte{
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				// Subject: CN=mariadb-client-ca
				// Serial Number: 11:f4:6a:f2:30:36:d6:ec:77:ce:3a:82:82:1c:25:96:db:06:f8:1c
				[]byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUEfRq8jA21ux3zjqCghwlltsG+BwwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYyNDU3
WhcNMjUxMTA4MTYyNDU3WjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKhHF1L244a48Sh/kua2L6nS
ks/7Rc1prfrXbrW18DdP3Txv91oJdxuaf27vs+7u+pEqRc7aiMd5gzIUIQCRxzOu
ECD61gNyddGtH2xnHB/ZK8PBvcB8W8z9kJf1RX5FeCpaBTnGlAY4uEclrC0wIEEC
F5UBVAbo9WZ4kOZaG8elKCuosCq3DWSQ2RXQLjs313oVPFbWkviLsLwMmtUjgUS2
CbD8exlED0E5IWcZizdrQDutXJnvyzCD/JzFOl44NdX7UncyX60pFNEd2tE6YAXs
qlmewtlhXGdv8LGCH4K88abOtuSKDwdHgyUdyaiwN6DDXlVfaIlQ3w/MvBu6LO8C
AwEAAaNTMFEwHQYDVR0OBBYEFBiTLoBFCUr64GI2pFVUQsXz8GrrMB8GA1UdIwQY
MBaAFBiTLoBFCUr64GI2pFVUQsXz8GrrMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAHqzSezpacxZPffqNNVDaE2Q5wHjJC5Riw9EOgPZmRRCBgy0
BIpU/KyzuuavC0rc4xe92CB1KWLAmRCn3N3Q+puE2EgegeLWcJLZaaopazFTOsjn
dgshSUdHJNX4AuWThcMbAcB3wL8NWiMcBm7Msali8BRTCHaDcLOVKlJFFEf3yDU2
aVQLZaLzDOcPvLeWAemq+/XQZ0fTivWCEjmulEckzfZb94z7KdCT6EOmclfgooWs
HAGu/N333lmpyEz/n7jaJiIhUm6pqgnenASpmHvg0A4s6AjSDcU9bi7vzhiAao2l
9zkvHa/nnrq2IZdut4QSzyXguba3WaYBQ8A5CXw=
-----END CERTIFICATE-----
`),
				// Subject: CN=mariadb-server-ca
				// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
				// Subject: CN=mariadb-server-ca
				// Serial Number: 0d:05:59:c6:ea:0f:f8:d8:c7:ed:c8:59:2b:4e:be:ee:d9:b9:19:44
				[]byte(`-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUDQVZxuoP+NjH7chZK06+7tm5GUQwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYyNDU3
WhcNMjUxMTA4MTYyNDU3WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAviAtaISvvI9yF/m6AMvrNiKQLxDy
QHBQtCFwUpIk3QrAAzvd799S3oiz2nBmtwnkyifSSHTACetkaf3+OLaqXaxzWyxl
4/2kmLv1n8Wg5onT+XiA6nBhaPFAHuf1kcI4JwBb4TsQfQt3SATsWaZ4TZanfxrL
TlBTz9Lddiv5ua0CAwEAAaNTMFEwHQYDVR0OBBYEFCKLnIBZkXjP7kAmoUi6/hX2
OUHGMB8GA1UdIwQYMBaAFCKLnIBZkXjP7kAmoUi6/hX2OUHGMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEAJmNGZ4q/kpRJ+tDWWMCozx1V8e3Jsqcg
giz0yT1GKjMcx/CnSKNRYAQktJR8AVwopCX/0iMLkf2rz76vg3Q5ZCKMSKJrPqZe
gThBbXzGBXZ2ggoB55X6sX5ChTEXoC4zZkPkPHIOwykZxqzq5qZkJtONo34zbvt4
hBOzji9QZ0Y=
-----END CERTIFICATE-----
`),
			},
			// Subject: CN=mariadb-client-ca
			// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
			// Subject: CN=mariadb-client-ca
			// Serial Number: 11:f4:6a:f2:30:36:d6:ec:77:ce:3a:82:82:1c:25:96:db:06:f8:1c
			// Subject: CN=mariadb-server-ca
			// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
			// Subject: CN=mariadb-server-ca
			// Serial Number: 0d:05:59:c6:ea:0f:f8:d8:c7:ed:c8:59:2b:4e:be:ee:d9:b9:19:44
			wantBytes: []byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUEfRq8jA21ux3zjqCghwlltsG+BwwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYyNDU3
WhcNMjUxMTA4MTYyNDU3WjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKhHF1L244a48Sh/kua2L6nS
ks/7Rc1prfrXbrW18DdP3Txv91oJdxuaf27vs+7u+pEqRc7aiMd5gzIUIQCRxzOu
ECD61gNyddGtH2xnHB/ZK8PBvcB8W8z9kJf1RX5FeCpaBTnGlAY4uEclrC0wIEEC
F5UBVAbo9WZ4kOZaG8elKCuosCq3DWSQ2RXQLjs313oVPFbWkviLsLwMmtUjgUS2
CbD8exlED0E5IWcZizdrQDutXJnvyzCD/JzFOl44NdX7UncyX60pFNEd2tE6YAXs
qlmewtlhXGdv8LGCH4K88abOtuSKDwdHgyUdyaiwN6DDXlVfaIlQ3w/MvBu6LO8C
AwEAAaNTMFEwHQYDVR0OBBYEFBiTLoBFCUr64GI2pFVUQsXz8GrrMB8GA1UdIwQY
MBaAFBiTLoBFCUr64GI2pFVUQsXz8GrrMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAHqzSezpacxZPffqNNVDaE2Q5wHjJC5Riw9EOgPZmRRCBgy0
BIpU/KyzuuavC0rc4xe92CB1KWLAmRCn3N3Q+puE2EgegeLWcJLZaaopazFTOsjn
dgshSUdHJNX4AuWThcMbAcB3wL8NWiMcBm7Msali8BRTCHaDcLOVKlJFFEf3yDU2
aVQLZaLzDOcPvLeWAemq+/XQZ0fTivWCEjmulEckzfZb94z7KdCT6EOmclfgooWs
HAGu/N333lmpyEz/n7jaJiIhUm6pqgnenASpmHvg0A4s6AjSDcU9bi7vzhiAao2l
9zkvHa/nnrq2IZdut4QSzyXguba3WaYBQ8A5CXw=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUDQVZxuoP+NjH7chZK06+7tm5GUQwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYyNDU3
WhcNMjUxMTA4MTYyNDU3WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAviAtaISvvI9yF/m6AMvrNiKQLxDy
QHBQtCFwUpIk3QrAAzvd799S3oiz2nBmtwnkyifSSHTACetkaf3+OLaqXaxzWyxl
4/2kmLv1n8Wg5onT+XiA6nBhaPFAHuf1kcI4JwBb4TsQfQt3SATsWaZ4TZanfxrL
TlBTz9Lddiv5ua0CAwEAAaNTMFEwHQYDVR0OBBYEFCKLnIBZkXjP7kAmoUi6/hX2
OUHGMB8GA1UdIwQYMBaAFCKLnIBZkXjP7kAmoUi6/hX2OUHGMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEAJmNGZ4q/kpRJ+tDWWMCozx1V8e3Jsqcg
giz0yT1GKjMcx/CnSKNRYAQktJR8AVwopCX/0iMLkf2rz76vg3Q5ZCKMSKJrPqZe
gThBbXzGBXZ2ggoB55X6sX5ChTEXoC4zZkPkPHIOwykZxqzq5qZkJtONo34zbvt4
hBOzji9QZ0Y=
-----END CERTIFICATE-----
`),
			wantErr: false,
		},
		{
			name: "duplicated certs",
			pems: [][]byte{
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				// Subject: CN=mariadb-client-ca
				// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
				[]byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
`),
				// Subject: CN=mariadb-server-ca
				// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
				// Subject: CN=mariadb-server-ca
				// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
				[]byte(`-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
`),
			},
			// Subject: CN=mariadb-client-ca
			// Serial Number: 37:99:13:93:cf:25:fa:4e:fe:7a:d2:52:42:be:8f:c5:ae:80:72:5a
			// Subject: CN=mariadb-server-ca
			// Serial Number: 73:2a:73:f7:28:1b:13:c5:44:ed:65:b3:82:e6:bd:ff:c4:92:0f:01
			wantBytes: []byte(`-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIUN5kTk88l+k7+etJSQr6Pxa6AclowDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1jbGllbnQtY2EwHhcNMjQxMTA4MTYwMjEw
WhcNMjUxMTA4MTYwMjEwWjAcMRowGAYDVQQDDBFtYXJpYWRiLWNsaWVudC1jYTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMRMveuOszN96fLvQjBX84TN
h/prPBdekHumfhc0Nc5kmdR1IyV/GH33vJ+Okv4BZakPbVtauKu0+Gk66nww4NCB
vC0B1+cRkWBzzc61D50/HBUK4qLg2fNhc2yM+yhb567BlbY7O/cmv9BG9WIHkV7G
lQXCEcAqRNFSRzpnzPCkH4296DELiPuWQuVpN7SMssLphxqHAwlshT2sbvdJp3fE
SRZo6c7Avz5jEbyWBrVFtjfKRiAEMUIt5op4kce/Ezdw5JnwWEzqqdWuYs431yCS
cg71ERlTkFF8YvGfdrPtVtFq2/QhddXstPdb5DNDSMNEI3+BFs3DQ4eQ4cyajw8C
AwEAAaNTMFEwHQYDVR0OBBYEFE6Vdm0R2KA2QjKkMgDFr8gubiRHMB8GA1UdIwQY
MBaAFE6Vdm0R2KA2QjKkMgDFr8gubiRHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
hvcNAQELBQADggEBAG5GU43A9R1Sfe2cBOMdxo4d4FKf0hpidDQOYK4jQUJWj6as
oTn/YS3M0DQns1XQtLp6LUCuB2ltnbY2A9SjfH6wQaEv7dOSpr+t1XAuafO/ULKE
QAJh2Oi9yno5qndPBGx3NmJPIHaHqx8oE6JMKCs+KOeK6/iYQ8y6ieG4pHRPYc33
+ueg0oAw+YNEyCJEOrC2cEpXAufuIK+aQxjhvtCgh4avubIJKE4Y8iNXeZIKU2Al
oKWVK/3dVfaY7BaHoQTYx7woE/pjRqaWiXwdY7qj3a8U/JZ5vmwdLv366NIgwgcM
nlrT7qODxkY2EJoXKI0fH9i0JJiCscPCPlBQulk=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICFDCCAX2gAwIBAgIUcypz9ygbE8VE7WWzgua9/8SSDwEwDQYJKoZIhvcNAQEL
BQAwHDEaMBgGA1UEAwwRbWFyaWFkYi1zZXJ2ZXItY2EwHhcNMjQxMTA4MTYwMjA5
WhcNMjUxMTA4MTYwMjA5WjAcMRowGAYDVQQDDBFtYXJpYWRiLXNlcnZlci1jYTCB
nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA0dxOiB+xCSOGFyS8ZDwxH3R5YTN7
iYu8imFjNmXUkkuyn29xNR88XtSlCHUI50mkXNbC2OZy3L6lx9f/EMEFWvgeOnMZ
X6k/1MNbO3UiBiCjj+5EvBJVsIK+9wwnOUMqx9rdrcTiDL3A4y5khOWcGU38Cdhi
R5RTfODJyiShDycCAwEAAaNTMFEwHQYDVR0OBBYEFPPnZRwuLQMhzc6XW6zhMpni
787XMB8GA1UdIwQYMBaAFPPnZRwuLQMhzc6XW6zhMpni787XMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQELBQADgYEASTjDiosKyoBPil1WhvB9q48Y1Vb109Sx
/f+vL3BzFJu9N3stNktvuQRbJupMdWgXAIt6a450K13V08VIhbOBTiuQglPAZ2xH
ioZBiiYjFpD/HE8JjSYav0cXlRDmJ2QozDBx33Uj9NCGKSYu79wZlWmcNU+jxegc
sgbc9YNM2vg=
-----END CERTIFICATE-----
`),
			wantErr: false,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			bundleBytes, err := BundleCertificatePEMs(logger, tt.pems...)
			if tt.wantErr && err == nil {
				t.Error("expect error to have occurred, got nil")
			}
			if !tt.wantErr && err != nil {
				t.Errorf("expect error to not have occurred, got: %v", err)
			}
			if diff := cmp.Diff(tt.wantBytes, bundleBytes); diff != "" {
				t.Errorf("unexpected bundle content (-want +got):\n%s", diff)
			}
		})
	}
}
